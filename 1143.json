{"device":"Workshop","url":"http:\/\/makeprojects.com\/Project\/Automated+Fan+Speed+Controller\/1143\/1","guide":{"author":{"text":"CraigCouden","userid":4495},"categories":["Workshop"],"conclusion":"<p>I had a lot of fun with this project. It taught me about microcontroller<wbr \/>s and stepper motors, and even gave me an excuse to play with Lego. This was my first project using the MAKE Controller, which I was eager to try, and I\u2019m already looking forward to my next \u201cMAKE Controlled\u201d project. Meanwhile, the fan control system has been very reliable during its 20-plus months of service.<\/p>\n\n<p><strong>This project first appeared in <a href=\"http:\/\/makezine.com\/21\">MAKE Volume 21<\/a>, page 139.<\/strong><\/p>","difficulty":"Moderate","documents":[],"flags":[{"title":"From MAKE Magazine","flagid":"FROM_MAKE","text":"This project first appeared on the pages of MAKE magazine."},{"title":"Unpublished","flagid":"GUIDE_PRIVATE","text":"This project guide will not appear in search results but can still be viewed by anyone!"}],"guideid":1143,"image":{"imageid":22219,"text":"http:\/\/guide-images.makeprojects.org\/igi\/GtcvLpBsktvMAJPm"},"introduction":"<p>When our house was built, I put a server room next to my office. Unfortunately, it had only a small bathroom-style fan with a 4&quot; duct leading outside, and during the summer I had to leave the door open, which made my office hot and loud.<\/p>\n\n<p>So I installed a larger fan, along with an 8&quot; duct that dumps the waste heat into our basement during winter and outside during the summer.<\/p>\n\n<p>The new fan works well, but also draws a lot of power \u2014 almost 300 watts. To reduce energy usage, I installed a manual speed control, but this made the temperature vary too much.<\/p>\n\n<p>Finally, I built a control system that automatically adjusts the fan speed to maintain a constant temperature in the room. I was already using a serial-port temperature sensor connected to a computer to monitor and plot the server room temperature, so I closed the control loop using a MAKE Controller, a stepper motor, and some Lego Technic gears to turn the manual speed control knob.<\/p>\n\n<p>I considered getting a different temperature sensor that would connect to the MAKE Controller directly. This would allow the system to stand alone without the computer. But in the end I chose to extend my existing setup and simply use the controller as an interface to the motor.<\/p>","introduction_rendered":"<p>When our house was built, I put a server room next to my office. Unfortunately, it had only a small bathroom-style fan with a 4&quot; duct leading outside, and during the summer I had to leave the door open, which made my office hot and loud.<\/p>\n\n<p>So I installed a larger fan, along with an 8&quot; duct that dumps the waste heat into our basement during winter and outside during the summer.<\/p>\n\n<p>The new fan works well, but also draws a lot of power \u2014 almost 300 watts. To reduce energy usage, I installed a manual speed control, but this made the temperature vary too much.<\/p>\n\n<p>Finally, I built a control system that automatically adjusts the fan speed to maintain a constant temperature in the room. I was already using a serial-port temperature sensor connected to a computer to monitor and plot the server room temperature, so I closed the control loop using a MAKE Controller, a stepper motor, and some Lego Technic gears to turn the manual speed control knob.<\/p>\n\n<p>I considered getting a different temperature sensor that would connect to the MAKE Controller directly. This would allow the system to stand alone without the computer. But in the end I chose to extend my existing setup and simply use the controller as an interface to the motor.<\/p><div class=\"parts\"><strong>Relevant parts<\/strong><ul><li><a href=\"http:\/\/makeprojects.com\/Item\/Temperature_sensor\">Temperature sensor<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Fan_control\">Fan control<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/MAKE_Controller_kit\">MAKE Controller kit<\/a><\/li><li><a href=\"http:\/\/www.hobbyking.com\/hobbyking\/store\/uh_viewitem.asp?idproduct=20708\">Motor<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Power_supplies\">Power supplies<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Lego_sets\">Lego sets<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Electrical_outlet_box\">Electrical outlet box<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Host_computer\">Host computer<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Ethernet_cable\">Ethernet cable<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Plywood\">Plywood<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Bracket\">Bracket<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Screws_and_standoffs\">Screws and standoffs<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Weight\">Weight<\/a><\/li><\/ul><\/div><div class=\"tools\"><strong>Tools<\/strong><ul><li><a href=\"http:\/\/makeprojects.com\/Item\/Drill\">Drill<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Glue_gun\">Glue gun<\/a><\/li><li><a href=\"http:\/\/makeprojects.com\/Item\/Screwdriver\">Screwdriver<\/a><\/li><li><a href=\"http:\/\/www.radioshack.com\/product\/index.jsp?productId=3932543\">Wire strippers<\/a><\/li><\/ul><\/div>","locale":"en","parts":[{"text":"Temperature sensor","notes":"I used a Hot\r\nLittle Therm from Spiderplant (spiderplant.com) that\u00e2\u20ac\u2122s unfortunately no longer being sold. You can\r\nalso wire an LM35 temperature sensor chip directly\r\nto the MAKE Controller (and tweak my Perl code to read the temperature from the controller, rather than executing the \u00e2\u20ac\u0153term\u00e2\u20ac\u009d program).","url":"http:\/\/makeprojects.com\/Item\/Temperature_sensor","thumbnail":""},{"text":"Fan control","notes":"Broan model #72W (broan.com)","url":"http:\/\/makeprojects.com\/Item\/Fan_control","thumbnail":""},{"text":"MAKE Controller kit","notes":"product #MKMT3 from Maker Shed\r\n(makershed.com), $120","url":"http:\/\/makeprojects.com\/Item\/MAKE_Controller_kit","thumbnail":""},{"text":"Motor","notes":"such as All Electronics part #SMT-116, #SMT-113, or #SMT-119 (allelectronics.com)","url":"http:\/\/www.hobbyking.com\/hobbyking\/store\/uh_viewitem.asp?idproduct=20708","thumbnail":""},{"text":"Power supplies","notes":"to power the MAKE Controller and stepper motor separately","url":"http:\/\/makeprojects.com\/Item\/Power_supplies","thumbnail":""},{"text":"Lego sets","notes":"Lego sets #10072-1, #10073-1, #10074-1, and #10076-1 (peeron.com)","url":"http:\/\/makeprojects.com\/Item\/Lego_sets","thumbnail":""},{"text":"Electrical outlet box","notes":"such as Wiremold\/Legrand #B3","url":"http:\/\/makeprojects.com\/Item\/Electrical_outlet_box","thumbnail":""},{"text":"Host computer","notes":"The computer will need to be on all the time, but if you\u00e2\u20ac\u2122re cooling a server room (like me) there should be no shortage of computers.","url":"http:\/\/makeprojects.com\/Item\/Host_computer","thumbnail":""},{"text":"Ethernet cable","notes":"","url":"http:\/\/makeprojects.com\/Item\/Ethernet_cable","thumbnail":""},{"text":"Plywood","notes":"","url":"http:\/\/makeprojects.com\/Item\/Plywood","thumbnail":""},{"text":"Bracket","notes":"such as Simpson Strong-Tie #FB24","url":"http:\/\/makeprojects.com\/Item\/Bracket","thumbnail":""},{"text":"Screws and standoffs","notes":"for mounting the controller board to wood; I salvaged some from various ATX computer cases.","url":"http:\/\/makeprojects.com\/Item\/Screws_and_standoffs","thumbnail":""},{"text":"Weight","notes":"","url":"http:\/\/makeprojects.com\/Item\/Weight","thumbnail":""}],"prereqs":[],"steps":[{"title":"Assemble the parts.","lines":[{"text":"I mounted all the hardware onto a scrap of board. I screwed an outlet box onto one corner for the 2 power supplies, and drilled the wood to let the 115V AC wiring enter through the back.","text_raw":"I mounted all the hardware onto a scrap of board. I screwed an outlet box onto one corner for the 2 power supplies, and drilled the wood to let the 115V AC wiring enter through the back.","bullet":"black","level":0},{"text":"I mounted the MAKE Controller in another corner using some hex screw standoffs, and I secured the stepper motor in a bracket sized to hold 2\u00d74 studs.","text_raw":"I mounted the MAKE Controller in another corner using some hex screw standoffs, and I secured the stepper motor in a bracket sized to hold 2\u00d74 studs.","bullet":"black","level":0},{"text":"Next came the connections. From the controller\u2019s Application Board, Main Power connects to DC (I used a 10V DC, 0.3A wall wart), and an Ethernet cable connects to the PC. The motor has 5 wires;  4 connect to Digital Outs Bank 1 on the Application Board and 1 connects to ground. I figured out which went where by trial and error.","text_raw":"Next came the connections. From the controller\u2019s Application Board, Main Power connects to DC (I used a 10V DC, 0.3A wall wart), and an Ethernet cable connects to the PC. The motor has 5 wires;  4 connect to Digital Outs Bank 1 on the Application Board and 1 connects to ground. I figured out which went where by trial and error.","bullet":"black","level":0}],"object":null,"images":[{"imageid":22219,"orderby":1,"text":"http:\/\/guide-images.makeprojects.org\/igi\/GtcvLpBsktvMAJPm"},{"imageid":22221,"orderby":2,"text":"http:\/\/guide-images.makeprojects.org\/igi\/Xq3leFZWCOow2dNT"}],"number":1},{"title":"","lines":[{"text":"The best part of the project was figuring out how to connect the stepper motor to the fan speed control.","text_raw":"The best part of the project was figuring out how to connect the stepper motor to the fan speed control.","bullet":"black","level":0},{"text":"One of the Lego gears fit over the stepper motor\u2019s shaft, but the speed control\u2019s knob shaft was recessed below a plate and harder to access. So I left its knob on, cut a hole in a Lego gear, and hot-glued the knob inside.","text_raw":"One of the Lego gears fit over the stepper motor\u2019s shaft, but the speed control\u2019s knob shaft was recessed below a plate and harder to access. So I left its knob on, cut a hole in a Lego gear, and hot-glued the knob inside.","bullet":"black","level":0}],"object":null,"images":[{"imageid":22224,"orderby":1,"text":"http:\/\/guide-images.makeprojects.org\/igi\/mDGCxjZhkOi1xcrO"},{"imageid":22223,"orderby":2,"text":"http:\/\/guide-images.makeprojects.org\/igi\/YXXAARBWpYTWTQxc"}],"number":2},{"title":"","lines":[{"text":"Lego gears span the distance between the motor and the knob, all attached to a long beam with short axle pins. I\u2019d like to say I designed the system of gears using algebra, but it was just trial and error. Additional beams and axles comprise a frame that wraps behind the speed control so the gears don\u2019t slide front-to-back. A small hanging weight keeps the last gear on the beam pressed down against the knob gear.","text_raw":"Lego gears span the distance between the motor and the knob, all attached to a long beam with short axle pins. I\u2019d like to say I designed the system of gears using algebra, but it was just trial and error. Additional beams and axles comprise a frame that wraps behind the speed control so the gears don\u2019t slide front-to-back. A small hanging weight keeps the last gear on the beam pressed down against the knob gear.","bullet":"black","level":0},{"text":"One problem was handling the situation when the stepper motor tries to turn the knob beyond its range. I wanted to keep the software stateless, so that it wouldn\u2019t have to care when the knob reached its maximum or minimum position. This was particularly important with my speed control, since turning it just past the maximum shuts the fan off.","text_raw":"One problem was handling the situation when the stepper motor tries to turn the knob beyond its range. I wanted to keep the software stateless, so that it wouldn\u2019t have to care when the knob reached its maximum or minimum position. This was particularly important with my speed control, since turning it just past the maximum shuts the fan off.","bullet":"black","level":0},{"text":"After some experimentation, I found the solution: I used a separate, weaker power supply (an old cellphone charger) for the stepper motor, which was strong enough to turn the knob through its On range, but not strong enough to click it over to Off. This works wonderfully and was simple to do on the MAKE Controller. I just connected the power supply to External Power 1 and set the jumper to VExt.","text_raw":"After some experimentation, I found the solution: I used a separate, weaker power supply (an old cellphone charger) for the stepper motor, which was strong enough to turn the knob through its On range, but not strong enough to click it over to Off. This works wonderfully and was simple to do on the MAKE Controller. I just connected the power supply to External Power 1 and set the jumper to VExt.","bullet":"black","level":0}],"object":null,"images":[{"imageid":22220,"orderby":1,"text":"http:\/\/guide-images.makeprojects.org\/igi\/WN6aiuVKDMPXuqoS"}],"number":3},{"title":"Install the software.","lines":[{"text":"I wrote the fan speed control code in Perl using the OpenSoundControl (OSC) module, which lets Perl talk to the MAKE Controller over either Ethernet or USB. If your computer runs BSD, Linux, or Mac OS X, you probably have Perl installed. Download the OSC module from <a href=\"http:\/\/opensoundcontrol.org\" rel=\"nofollow\">http:\/\/opensoundcontrol.org<\/a>. You can download my project code at <a href=\"http:\/\/cdn.makezine.com\/make\/21\/fanspeedcontrollercode_Perlscript.rtf\" title=\"http:\/\/cdn.makezine.com\/make\/21\/fanspeedcontrollercode_Perlscript.rtf\">http:\/\/cdn.makezine.com\/make\/21\/fanspeed...<\/a>.","text_raw":"I wrote the fan speed control code in Perl using the OpenSoundControl (OSC) module, which lets Perl talk to the MAKE Controller over either Ethernet or USB. If your computer runs BSD, Linux, or Mac OS X, you probably have Perl installed. Download the OSC module from http:\/\/opensoundcontrol.org. You can download my project code at http:\/\/cdn.makezine.com\/make\/21\/fanspeedcontrollercode_Perlscript.rtf.","bullet":"black","level":0},{"text":"I configured OSC to use Ethernet rather than USB because it doesn\u2019t require any special drivers. The MAKE Controller gets an IP address for the computer via DHCP and listens for OSC commands to move the motor on port 10000.","text_raw":"I configured OSC to use Ethernet rather than USB because it doesn\u2019t require any special drivers. The MAKE Controller gets an IP address for the computer via DHCP and listens for OSC commands to move the motor on port 10000.","bullet":"black","level":0},{"text":"The stepper motor is controlled by 4 digital output pins that correspond to the motor\u2019s 4 coils. To nudge the motor a step in either direction, the controller changes the outputs to energize different coils.","text_raw":"The stepper motor is controlled by 4 digital output pins that correspond to the motor\u2019s 4 coils. To nudge the motor a step in either direction, the controller changes the outputs to energize different coils.","bullet":"black","level":0},{"text":"For continuous motion, the code needs a delay between steps to give the motor shaft time to find its new position. Welcome to the world of stepper motors, which behave very differently from servos.","text_raw":"For continuous motion, the code needs a delay between steps to give the motor shaft time to find its new position. Welcome to the world of stepper motors, which behave very differently from servos.","bullet":"black","level":0},{"text":"Obviously if the temperature is high the fan speed should be increased, and vice versa. But for programmed control, the question is how frequently should adjustments be made, and by what amount?","text_raw":"Obviously if the temperature is high the fan speed should be increased, and vice versa. But for programmed control, the question is how frequently should adjustments be made, and by what amount?","bullet":"black","level":0},{"text":"I found that it works well to step the motor some number of ticks based on the logarithm of the difference between the measured and desired temperature. If the two are close, then no adjustment is made, 95% of the time. For the few other times, the system turns down the fan speed by one tick, so that it finds the minimum speed necessary to maintain the target temperature.","text_raw":"I found that it works well to step the motor some number of ticks based on the logarithm of the difference between the measured and desired temperature. If the two are close, then no adjustment is made, 95% of the time. For the few other times, the system turns down the fan speed by one tick, so that it finds the minimum speed necessary to maintain the target temperature.","bullet":"black","level":0}],"object":null,"images":[],"number":4},{"title":"","lines":[{"text":"To run the program, <em>fanspeed.pl<\/em>, you need your controller\u2019s IP address. You can find this using the mchelper app, downloadable from the controller\u2019s maker, Making Things (<a href=\"http:\/\/makingthings.com\" rel=\"nofollow\">http:\/\/makingthings.com<\/a>). Then run the Perl script in a terminal window, like this:","text_raw":"To run the program, ''fanspeed.pl'', you need your controller\u2019s IP address. You can find this using the mchelper app, downloadable from the controller\u2019s maker, Making Things (http:\/\/makingthings.com). Then run the Perl script in a terminal window, like this:","bullet":"black","level":0},{"text":"<em>$ perl fanspeed.pl [desired-temperature] - [ip-address]<\/em>","text_raw":"''$ perl fanspeed.pl [desired-temperature] - [ip-address]''","bullet":"black","level":1},{"text":"where <em>desired-temperature<\/em> is in degrees Fahrenheit and <em>ip-address<\/em> is the address of the MAKE Controller.","text_raw":"where ''desired-temperature'' is in degrees Fahrenheit and ''ip-address'' is the address of the MAKE Controller.","bullet":"black","level":0},{"text":"Running the script to keep the temperature at 80\u00baF, for example, would look like like this:","text_raw":"Running the script to keep the temperature at 80\u00baF, for example, would look like like this:","bullet":"black","level":0},{"text":"<em>$ perl fanspeed.pl 80 - 10.0.0.9<\/em>","text_raw":"''$ perl fanspeed.pl 80 - 10.0.0.9''","bullet":"black","level":1},{"text":"The program will then periodically log the temperature and stepper commands in the terminal window.","text_raw":"The program will then periodically log the temperature and stepper commands in the terminal window.","bullet":"black","level":0},{"text":"I use the open source data logging and graphing system RRDtool (<a href=\"http:\/\/oss.oetiker.ch\/rrdtool\" rel=\"nofollow\">http:\/\/oss.oetiker.ch\/rrdtool<\/a>) to track air temperatures inside and outside my server room. The photo shows the month I placed the speed controller into service. Note how the red line \u2014 air coming out of the room \u2014 went nice and flat.","text_raw":"I use the open source data logging and graphing system RRDtool (http:\/\/oss.oetiker.ch\/rrdtool) to track air temperatures inside and outside my server room. The photo shows the month I placed the speed controller into service. Note how the red line \u2014 air coming out of the room \u2014 went nice and flat.","bullet":"black","level":0}],"object":null,"images":[{"imageid":22222,"orderby":1,"text":"http:\/\/guide-images.makeprojects.org\/igi\/ZEFO3F1ZU4TSDRps"}],"number":5}],"subject":"","summary":"Steady temperatures in a server room, using the MAKE Controller.","time_required":"","title":"Automated Fan Speed Controller","tools":[{"text":"Drill","notes":"","url":"http:\/\/makeprojects.com\/Item\/Drill","thumbnail":""},{"text":"Glue gun","notes":"","url":"http:\/\/makeprojects.com\/Item\/Glue_gun","thumbnail":""},{"text":"Screwdriver","notes":"","url":"http:\/\/makeprojects.com\/Item\/Screwdriver","thumbnail":""},{"text":"Wire strippers","notes":"","url":"http:\/\/www.radioshack.com\/product\/index.jsp?productId=3932543","thumbnail":""}],"type":"project"},"guideid":"1143"}